<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FSOCIETY TERMINAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --green:#00ff9c;
  --red:#ff3333;
}

* { box-sizing:border-box; }

body {
  margin:0;
  background:black;
  color:var(--green);
  font-family:monospace;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}

/* TERMINAL */
#terminal {
  width:100%;
  max-width:480px;
  border:2px solid var(--green);
  padding:20px;
  box-shadow:0 0 30px #00ff9c55;
}

/* HEADERS */
h1 {
  text-align:center;
  font-size:15px;
  letter-spacing:3px;
  margin-bottom:20px;
}

/* LOGIN INFO */
.status {
  font-size:12px;
  opacity:.8;
  margin-bottom:6px;
}

/* INPUTS */
input, button {
  width:100%;
  background:black;
  border:1px solid var(--green);
  color:var(--green);
  padding:12px;
  margin-top:10px;
  font-family:inherit;
}

input:focus {
  outline:none;
  box-shadow:0 0 10px var(--green);
}

button {
  cursor:pointer;
  letter-spacing:2px;
}

button:hover {
  background:var(--green);
  color:black;
}

/* ERROR */
#error {
  color:var(--red);
  text-align:center;
  margin-top:10px;
  font-weight:bold;
}

/* CHAT */
#chat { display:none; }

#messages {
  height:240px;
  overflow-y:auto;
  border:1px solid var(--green);
  padding:10px;
  margin-bottom:10px;
  background:black;
}

.msg {
  margin-bottom:6px;
  word-wrap:break-word;
}

.me { color:#00ffaa; }
.sys { color:#ffaa00; }

/* MOBILE */
@media (max-width:480px) {
  #terminal {
    border:none;
    box-shadow:none;
    height:100vh;
    display:flex;
    flex-direction:column;
  }
  #messages { flex:1; }
}
</style>
</head>

<body>

<div id="terminal">

<!-- LOGIN -->
<div id="login">
  <h1>FSOCIETY ACCESS NODE</h1>
  <div class="status">[+] Routing traffic through proxy</div>
  <div class="status">[+] Encryption layer active</div>
  <div class="status">[!] Unauthorized access will be logged</div>

  <input id="pseudo" placeholder="IDENTITY">
  <input id="code" type="password" placeholder="ACCESS KEY">
  <button id="loginBtn">INIT ACCESS</button>
  <div id="error"></div>
</div>

<!-- CHAT -->
<div id="chat">
  <h1>SECURE CHANNEL</h1>
  <div id="messages"></div>
  <input id="message" placeholder="> type message">
  <button id="sendBtn">SEND</button>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

<script>
/* FIREBASE INIT */
firebase.initializeApp({
  apiKey: "AIzaSyCpo7up--nfVG4zj_Zeu4kB7pr34ad4ceM",
  authDomain: "lycee-europe-private.firebaseapp.com",
  projectId: "lycee-europe-private",
  storageBucket: "lycee-europe-private.firebasestorage.app",
  messagingSenderId: "259168134432",
  appId: "1:259168134432:web:470f5536d9305b4cf86345"
});

const db = firebase.firestore();
const messagesRef = db.collection("messages_prives");

/* DOM */
const loginBox = document.getElementById("login");
const chatBox = document.getElementById("chat");
const pseudoInput = document.getElementById("pseudo");
const codeInput = document.getElementById("code");
const errorBox = document.getElementById("error");
const messagesBox = document.getElementById("messages");
const messageInput = document.getElementById("message");

let ACCESS_CODE = null;
let currentPseudo = null;

/* LOAD ACCESS CODE */
async function loadCode() {
  const doc = await db.collection("config").doc("access").get();
  if (doc.exists) ACCESS_CODE = doc.data().code;
}

/* LOGIN */
async function login() {
  const pseudo = pseudoInput.value.trim();
  const code = codeInput.value.trim();

  if (!ACCESS_CODE) await loadCode();

  if (!pseudo || !code) {
    errorBox.textContent = "AUTH FAILED";
    return;
  }

  if (code !== ACCESS_CODE) {
    errorBox.textContent = "ACCESS DENIED";
    return;
  }

  currentPseudo = pseudo;
  loginBox.style.display="none";
  chatBox.style.display="block";
  systemMessage("Secure channel established");
  listenMessages();
}

/* SYSTEM MESSAGE */
function systemMessage(text) {
  messagesBox.innerHTML += `<div class="msg sys">[SYSTEM] ${text}</div>`;
}

/* LISTEN CHAT */
function listenMessages() {
  messagesRef.orderBy("timestamp").onSnapshot(snap=>{
    messagesBox.innerHTML="";
    snap.forEach(d=>{
      const m=d.data();
      const cls = m.pseudo===currentPseudo?"me":"";
      messagesBox.innerHTML+=`<div class="msg ${cls}">[${m.pseudo}] ${m.message}</div>`;
    });
    messagesBox.scrollTop=messagesBox.scrollHeight;
  });
}

/* SEND */
async function sendMessage() {
  if (!messageInput.value.trim()) return;
  await messagesRef.add({
    pseudo: currentPseudo,
    message: messageInput.value,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
  messageInput.value="";
}

/* EVENTS */
document.getElementById("loginBtn").onclick = login;
document.getElementById("sendBtn").onclick = sendMessage;
messageInput.addEventListener("keydown",e=>{
  if(e.key==="Enter") sendMessage();
});
</script>

</body>
</html>