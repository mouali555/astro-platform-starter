<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>SECURE ACCESS TERMINAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    background: black;
    color: #00ff99;
    font-family: monospace;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

#terminal {
    width: 420px;
    border: 2px solid #00ff99;
    padding: 25px;
    box-shadow: 0 0 25px #00ff99;
}

h1 {
    text-align: center;
    font-size: 18px;
    margin-bottom: 20px;
}

input, button {
    width: 100%;
    background: black;
    border: 1px solid #00ff99;
    color: #00ff99;
    padding: 12px;
    margin-top: 10px;
    font-family: monospace;
}

button {
    cursor: pointer;
}

button:hover {
    background: #00ff99;
    color: black;
}

#error {
    color: red;
    margin-top: 10px;
    text-align: center;
}

#chat {
    display: none;
}

#messages {
    height: 250px;
    overflow-y: auto;
    border: 1px solid #00ff99;
    padding: 10px;
    margin-bottom: 10px;
}
</style>
</head>

<body>

<div id="terminal">
    <div id="login">
        <h1>üîê SECURE TERMINAL ACCESS</h1>
        <input id="pseudo" placeholder="IDENTITY">
        <input id="code" type="password" placeholder="ACCESS CODE">
        <button onclick="login()">CONNECT</button>
        <div id="error"></div>
    </div>

    <div id="chat">
        <h1>üü¢ ACCESS GRANTED</h1>
        <div id="messages"></div>
        <input id="message" placeholder="> enter message">
        <button onclick="sendMessage()">SEND</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCpo7up--nfVG4zj_Zeu4kB7pr34ad4ceM",
  authDomain: "lycee-europe-private.firebaseapp.com",
  projectId: "lycee-europe-private",
  storageBucket: "lycee-europe-private.firebasestorage.app",
  messagingSenderId: "259168134432",
  appId: "1:259168134432:web:470f5536d9305b4cf86345"
});

const db = firebase.firestore();
const messagesRef = db.collection("messages_prives");

let ACCESS_CODE = null;
let currentPseudo = null;

async function loadCode() {
    const doc = await db.collection("config").doc("access").get();
    if (doc.exists) ACCESS_CODE = doc.data().code;
}

async function login() {
    const pseudo = document.getElementById("pseudo").value.trim();
    const code = document.getElementById("code").value.trim();
    const error = document.getElementById("error");

    if (!ACCESS_CODE) await loadCode();

    if (!pseudo || !code) {
        error.textContent = "FIELDS REQUIRED";
        return;
    }

    if (code !== ACCESS_CODE) {
        error.textContent = "ACCESS DENIED";
        return;
    }

    currentPseudo = pseudo;
    document.getElementById("login").style.display = "none";
    document.getElementById("chat").style.display = "block";
    listenMessages();
}

function listenMessages() {
    messagesRef.orderBy("timestamp").onSnapshot(snapshot => {
        const box = document.getElementById("messages");
        box.innerHTML = "";
        snapshot.forEach(doc => {
            const m = doc.data();
            box.innerHTML += `<div>[${m.pseudo}] ${m.message}</div>`;
        });
        box.scrollTop = box.scrollHeight;
    });
}

async function sendMessage() {
    const input = document.getElementById("message");
    if (!input.value.trim()) return;

    await messagesRef.add({
        pseudo: currentPseudo,
        message: input.value,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

    input.value = "";
}
</script>

</body>
</html>
