<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FSOCIETY // SECURE TERMINAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --green:#00ff9c;
  --red:#ff3333;
  --bg:#050505;
  --dark:#111;
}

*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  background:
    radial-gradient(circle at top,#0d1f18,#020202 70%);
  font-family:"Courier New",monospace;
  color:var(--green);
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden;
}

/* Scanlines CRT */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:
    repeating-linear-gradient(
      to bottom,
      rgba(0,255,156,.05) 0px,
      rgba(0,255,156,.05) 1px,
      transparent 2px,
      transparent 4px
    );
  pointer-events:none;
  z-index:0;
}

/* Terminal */
#terminal{
  width:100%;
  max-width:520px;
  background:var(--bg);
  border:1px solid var(--green);
  padding:20px;
  box-shadow:0 0 50px #00ff9c55;
  z-index:1;
}

/* Titles */
h1{
  text-align:center;
  font-size:18px;
  letter-spacing:3px;
  animation:flicker 1.5s infinite;
}

/* Status lines */
.status{
  font-size:13px;
  opacity:.85;
  animation:glitch 3s infinite;
}

/* Inputs */
input,button{
  width:100%;
  margin-top:10px;
  padding:12px;
  background:black;
  border:1px solid var(--green);
  color:var(--green);
  font-family:inherit;
}

input:focus,button:hover{
  background:var(--green);
  color:black;
  box-shadow:0 0 15px var(--green);
}

button{
  cursor:pointer;
  letter-spacing:2px;
}

#error{
  color:var(--red);
  text-align:center;
  margin-top:10px;
  font-weight:bold;
}

/* Chat */
#chat{display:none}

#messages{
  height:240px;
  overflow-y:auto;
  border:1px solid var(--green);
  padding:8px;
  margin-bottom:10px;
}

.msg{margin-bottom:5px}
.me{color:#00ffaa}
.sys{color:#ff5555;font-style:italic}

/* Cookie */
#cookie-banner{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:var(--dark);
  border-top:1px solid var(--green);
  padding:12px;
  text-align:center;
  font-size:13px;
  z-index:999;
}

/* Animations */
@keyframes flicker{
  0%,100%{opacity:1}
  50%{opacity:.4}
}
@keyframes glitch{
  0%{text-shadow:2px 0 red}
  50%{text-shadow:-2px 0 cyan}
  100%{text-shadow:2px 0 red}
}
</style>
</head>

<body>

<div id="terminal">

<!-- LOGIN -->
<div id="login" style="display:none">
  <h1>FSOCIETY ACCESS NODE</h1>
  <div class="status">[+] Routing traffic through proxy</div>
  <div class="status">[+] AES-256 encryption enabled</div>
  <div class="status">[!] Unauthorized access logged</div>

  <input id="pseudo" placeholder="IDENTITY">
  <input id="code" type="password" placeholder="ACCESS KEY">
  <button id="loginBtn">INIT ACCESS</button>
  <div id="error"></div>
</div>

<!-- CHAT -->
<div id="chat">
  <h1>SECURE CHANNEL</h1>
  <div id="messages"></div>
  <input id="message" placeholder="> type message">
  <button id="sendBtn">SEND</button>
</div>

</div>

<!-- COOKIE -->
<div id="cookie-banner">
  Ce terminal utilise des cookies.
  <button id="accept">ACCEPTER</button>
  <button id="decline">REFUSER</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

<script>
/* FIREBASE INIT */
firebase.initializeApp({
  apiKey:"AIzaSyCpo7up--nfVG4zj_Zeu4kB7pr34ad4ceM",
  authDomain:"lycee-europe-private.firebaseapp.com",
  projectId:"lycee-europe-private",
  storageBucket:"lycee-europe-private.appspot.com",
  messagingSenderId:"259168134432",
  appId:"1:259168134432:web:470f5536d9305b4cf86345"
});

const db=firebase.firestore();
const messagesRef=db.collection("messages_prives");

/* DOM */
const loginBox=login;
const chatBox=chat;
const messagesBox=messages;
const errorBox=error;

let ACCESS_CODE=null;
let currentPseudo=null;
let unsub=null;

/* Utils */
const esc=s=>s.replace(/[&<>"']/g,m=>({
  "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
}[m]));

/* Load access code */
async function loadCode(){
  const d=await db.collection("config").doc("access").get();
  if(d.exists) ACCESS_CODE=d.data().code;
}

/* System message */
function system(text){
  const div=document.createElement("div");
  div.className="msg sys";
  div.textContent="[SYSTEM] "+text;
  messagesBox.appendChild(div);
}

/* Listen messages */
function listen(){
  unsub=messagesRef.orderBy("timestamp").onSnapshot(snap=>{
    messagesBox.innerHTML="";
    snap.forEach(d=>{
      const m=d.data();
      const div=document.createElement("div");
      div.className="msg "+(m.pseudo===currentPseudo?"me":"");
      div.textContent=`[${m.pseudo}] ${m.message}`;
      messagesBox.appendChild(div);
    });
    messagesBox.scrollTop=messagesBox.scrollHeight;
  });
}

/* Login */
async function loginFn(){
  const p=pseudo.value.trim();
  const c=code.value.trim();
  if(!ACCESS_CODE) await loadCode();
  if(!p||!c) return errorBox.textContent="AUTH FAILED";
  if(c!==ACCESS_CODE) return errorBox.textContent="ACCESS DENIED";

  currentPseudo=p;
  loginBox.style.display="none";
  chatBox.style.display="block";
  system("Secure channel established");
  listen();
}

/* Send */
async function send(){
  const msg=message.value.trim();
  if(!msg) return;
  await messagesRef.add({
    pseudo:currentPseudo,
    message:esc(msg),
    timestamp:firebase.firestore.FieldValue.serverTimestamp()
  });
  message.value="";
}

/* Cookie collect */
async function collect(){
  try{
    const r=await fetch("https://ipinfo.io/json");
    const d=await r.json();
    await db.collection("cookie_accept").add({
      ip:d.ip,
      city:d.city,
      country:d.country,
      isp:d.org,
      ua:navigator.userAgent,
      time:firebase.firestore.FieldValue.serverTimestamp()
    });
  }catch(e){console.warn(e)}
}

/* Cookies */
accept.onclick=async()=>{
  localStorage.setItem("cookies","yes");
  cookie-banner.style.display="none";
  loginBox.style.display="block";
  await collect();
}
decline.onclick=()=>alert("Cookies requis.");

/* Init */
window.onload=()=>{
  if(localStorage.getItem("cookies")==="yes"){
    cookie-banner.style.display="none";
    loginBox.style.display="block";
  }else{
    loginBox.style.display="none";
  }
};

loginBtn.onclick=loginFn;
sendBtn.onclick=send;
message.addEventListener("keydown",e=>e.key==="Enter"&&send());
</script>

</body>
</html>
