<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FSOCIETY NODE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
@keyframes flicker {
  0% {opacity:1}
  50% {opacity:.96}
  100% {opacity:1}
}
@keyframes glitch {
  0% {text-shadow:2px 0 red,-2px 0 cyan}
  50% {text-shadow:-2px 0 red,2px 0 cyan}
  100% {text-shadow:2px 0 red,-2px 0 cyan}
}

body {
  margin:0;
  background:black;
  color:#00ff9c;
  font-family:Courier, monospace;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  animation:flicker .15s infinite;
  cursor:crosshair;
  user-select:none;
}

#noise {
  position:fixed;
  inset:0;
  background:radial-gradient(#ffffff10 1px, transparent 1px);
  background-size:3px 3px;
  opacity:.05;
  pointer-events:none;
}

#terminal {
  width:100%;
  max-width:480px;
  padding:20px;
  border:2px solid #00ff9c;
  box-shadow:0 0 40px #00ff9c55;
}

h1 {
  font-size:14px;
  text-align:center;
  letter-spacing:3px;
  animation:glitch .35s infinite;
}

.line {
  font-size:12px;
  opacity:.75;
}

input,button {
  width:100%;
  background:black;
  border:1px solid #00ff9c;
  color:#00ff9c;
  padding:12px;
  margin-top:10px;
  font-family:inherit;
}

button:hover {
  background:#00ff9c;
  color:black;
  cursor:pointer;
}

#error {
  color:#ff3333;
  text-align:center;
  margin-top:10px;
}

#chat { display:none; }

#messages {
  height:240px;
  overflow:auto;
  border:1px solid #00ff9c;
  padding:10px;
  margin-bottom:10px;
}

.msg { margin-bottom:6px; }
.sys { color:#ffaa00; }
.me { color:#00ffaa; }
</style>
</head>

<body oncontextmenu="return false">

<div id="noise"></div>

<div id="terminal">

<!-- LOGIN -->
<div id="login">
<h1>FSOCIETY ACCESS</h1>
<div class="line">> routing traffic</div>
<div class="line">> encryption active</div>
<div class="line">> unauthorized access logged</div>

<input id="pseudo" placeholder="IDENTITY">
<input id="code" type="password" placeholder="ACCESS KEY">
<button id="loginBtn">ENTER</button>
<div id="error"></div>
</div>

<!-- CHAT -->
<div id="chat">
<h1>SECURE CHANNEL</h1>
<div id="messages"></div>
<input id="message" placeholder="> transmit">
<button id="sendBtn">SEND</button>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

<script>
/* ðŸ”¥ FIREBASE CONFIG â€” COMPLET */
firebase.initializeApp({
  apiKey: "AIzaSyCpo7up--nfVG4zj_Zeu4kB7pr34ad4ceM",
  authDomain: "lycee-europe-private.firebaseapp.com",
  projectId: "lycee-europe-private",
  storageBucket: "lycee-europe-private.firebasestorage.app",
  messagingSenderId: "259168134432",
  appId: "1:259168134432:web:470f5536d9305b4cf86345"
});

const db = firebase.firestore();
const messagesRef = db.collection("messages_prives");

/* STATE */
let ACCESS_CODE = null;
let currentUser = null;

/* LOAD ACCESS */
async function loadCode() {
  const doc = await db.collection("config").doc("access").get();
  if (doc.exists) ACCESS_CODE = doc.data().code;
}

/* LOGIN */
async function login() {
  const p = pseudo.value.trim();
  const c = code.value.trim();

  if (!ACCESS_CODE) await loadCode();

  if (!p || !c) {
    error.textContent = "AUTH FAILED";
    return;
  }

  if (c !== ACCESS_CODE) {
    error.textContent = "ACCESS DENIED";
    return;
  }

  currentUser = p;
  login.style.display = "none";
  chat.style.display = "block";
  systemMessage("SECURE LINK ESTABLISHED");
  listenMessages();
}

/* SYSTEM MSG */
function systemMessage(text) {
  messages.innerHTML += `<div class="msg sys">[SYS] ${text}</div>`;
}

/* LISTEN CHAT */
function listenMessages() {
  messagesRef.orderBy("timestamp").onSnapshot(snapshot => {
    messages.innerHTML = "";
    snapshot.forEach(doc => {
      const m = doc.data();
      messages.innerHTML += `
        <div class="msg ${m.pseudo === currentUser ? 'me' : ''}">
          [${m.pseudo}] ${m.message}
        </div>`;
    });
    messages.scrollTop = messages.scrollHeight;
  });
}

/* SEND */
async function sendMessage() {
  if (!message.value.trim()) return;

  await messagesRef.add({
    pseudo: currentUser,
    message: message.value,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });

  message.value = "";
}

/* EVENTS */
loginBtn.onclick = login;
sendBtn.onclick = sendMessage;
message.onkeydown = e => { if (e.key === "Enter") sendMessage(); };

/* FAKE ANTI-DEV */
document.addEventListener("keydown", e => {
  if (e.key === "F12") {
    document.body.innerHTML =
      "<h1 style='color:red;text-align:center'>SESSION TERMINATED</h1>";
  }
});
</script>

</body>
</html>