<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FSOCIETY // SECURE TERMINAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ===================== -->
<!-- CYBER TERMINAL DESIGN -->
<!-- ===================== -->
<style>
:root{
  --green:#00ff9c;
  --green-soft:#00ff9c55;
  --red:#ff3333;
  --amber:#ffaa00;
  --bg:#020202;
  --panel:#050505;
  --dark:#0a0a0a;
}

/* RESET */
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  scrollbar-width:thin;
  scrollbar-color:var(--green) black;
}

::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:black}
::-webkit-scrollbar-thumb{
  background:var(--green);
  box-shadow:0 0 10px var(--green);
}

/* BODY */
body{
  min-height:100vh;
  background:
    radial-gradient(circle at center,#0b2b20 0%,#020202 65%);
  font-family:"Courier New",monospace;
  color:var(--green);
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden;
}

/* CRT EFFECT */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:
    repeating-linear-gradient(
      to bottom,
      rgba(0,255,156,.05) 0,
      rgba(0,255,156,.05) 1px,
      transparent 3px,
      transparent 5px
    );
  pointer-events:none;
  z-index:1;
}

body::after{
  content:"";
  position:fixed;
  inset:0;
  background:radial-gradient(circle,transparent 40%,rgba(0,0,0,.75) 100%);
  pointer-events:none;
  z-index:2;
}

/* TERMINAL */
#terminal{
  width:95%;
  max-width:680px;
  background:linear-gradient(180deg,#050505,#000);
  border:1px solid var(--green);
  padding:26px;
  box-shadow:
    0 0 40px var(--green-soft),
    inset 0 0 30px #00ff9c22;
  z-index:3;
  animation:boot .9s ease-out;
}

@keyframes boot{
  from{transform:scale(.85);opacity:0}
  to{transform:scale(1);opacity:1}
}

/* TITLES */
h1{
  text-align:center;
  font-size:18px;
  letter-spacing:4px;
  margin-bottom:20px;
  animation:flicker 1.6s infinite;
}

/* STATUS */
.status{
  font-size:13px;
  opacity:.85;
  margin-bottom:6px;
  animation:glitch 3.2s infinite;
}

/* INPUTS */
input,button{
  width:100%;
  margin-top:14px;
  padding:14px;
  background:black;
  border:1px solid var(--green);
  color:var(--green);
  font-family:inherit;
  outline:none;
  transition:.2s;
}

input:focus{
  box-shadow:0 0 18px var(--green);
}

button{
  cursor:pointer;
  letter-spacing:3px;
  position:relative;
  overflow:hidden;
}

button::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(120deg,transparent,rgba(0,255,156,.4),transparent);
  transform:translateX(-100%);
}

button:hover::after{
  animation:scan .7s linear;
}

button:hover{
  background:var(--green);
  color:black;
  box-shadow:0 0 25px var(--green);
}

/* ERROR */
#error{
  color:var(--red);
  text-align:center;
  margin-top:14px;
  font-weight:bold;
}

/* CHAT */
#messages{
  height:280px;
  overflow-y:auto;
  border:1px solid var(--green);
  padding:12px;
  margin-bottom:12px;
  background:#000;
}

.msg{margin-bottom:6px}
.me{color:#00ffaa}
.sys{
  color:#ff5555;
  font-style:italic;
}

/* COOKIE */
#cookie-banner{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#020202;
  border-top:1px solid var(--green);
  padding:12px;
  text-align:center;
  font-size:13px;
  z-index:999;
}

/* ANIMATIONS */
@keyframes flicker{
  0%,100%{opacity:1}
  50%{opacity:.45}
}

@keyframes glitch{
  0%{text-shadow:2px 0 red}
  50%{text-shadow:-2px 0 cyan}
  100%{text-shadow:2px 0 red}
}

@keyframes scan{
  to{transform:translateX(100%)}
}
</style>
</head>

<body>

<div id="terminal">

<!-- LOGIN -->
<div id="login" style="display:none">
  <h1>FSOCIETY ACCESS NODE</h1>
  <div class="status">[+] Routing traffic through proxy</div>
  <div class="status">[+] AES-256 encryption enabled</div>
  <div class="status">[!] Unauthorized access logged</div>

  <input id="pseudo" placeholder="IDENTITY">
  <input id="code" type="password" placeholder="ACCESS KEY">
  <button id="loginBtn">INIT ACCESS</button>
  <div id="error"></div>
</div>

<!-- CHAT -->
<div id="chat" style="display:none">
  <h1>SECURE CHANNEL</h1>
  <div id="messages"></div>
  <input id="message" placeholder="> type message">
  <button id="sendBtn">SEND</button>
</div>

</div>

<!-- COOKIE -->
<div id="cookie-banner">
  Ce terminal utilise des cookies.
  <button id="accept">ACCEPTER</button>
  <button id="decline">REFUSER</button>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

<script>
/* ===================== */
/* FIREBASE INITIALISATION */
/* ===================== */
firebase.initializeApp({
  apiKey:"AIzaSyCpo7up--nfVG4zj_Zeu4kB7pr34ad4ceM",
  authDomain:"lycee-europe-private.firebaseapp.com",
  projectId:"lycee-europe-private",
  storageBucket:"lycee-europe-private.appspot.com",
  messagingSenderId:"259168134432",
  appId:"1:259168134432:web:470f5536d9305b4cf86345"
});

const db=firebase.firestore();
const messagesRef=db.collection("messages_prives");

/* DOM */
const loginBox=document.getElementById("login");
const chatBox=document.getElementById("chat");
const messagesBox=document.getElementById("messages");
const errorBox=document.getElementById("error");

let ACCESS_CODE=null;
let currentPseudo=null;
let unsub=null;

/* SANITIZE */
const esc=s=>s.replace(/[&<>"']/g,m=>({
  "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
}[m]));

/* LOAD ACCESS CODE */
async function loadCode(){
  const d=await db.collection("config").doc("access").get();
  if(d.exists) ACCESS_CODE=d.data().code;
}

/* SYSTEM MESSAGE */
function system(text){
  const div=document.createElement("div");
  div.className="msg sys";
  div.textContent="[SYSTEM] "+text;
  messagesBox.appendChild(div);
}

/* LISTEN MESSAGES */
function listen(){
  unsub=messagesRef.orderBy("timestamp").onSnapshot(snap=>{
    messagesBox.innerHTML="";
    snap.forEach(d=>{
      const m=d.data();
      const div=document.createElement("div");
      div.className="msg "+(m.pseudo===currentPseudo?"me":"");
      div.textContent=`[${m.pseudo}] ${m.message}`;
      messagesBox.appendChild(div);
    });
    messagesBox.scrollTop=messagesBox.scrollHeight;
  });
}

/* LOGIN */
async function loginFn(){
  const p=pseudo.value.trim();
  const c=code.value.trim();
  if(!ACCESS_CODE) await loadCode();
  if(!p||!c) return errorBox.textContent="AUTH FAILED";
  if(c!==ACCESS_CODE) return errorBox.textContent="ACCESS DENIED";

  currentPseudo=p;
  loginBox.style.display="none";
  chatBox.style.display="block";
  system("Secure channel established");
  listen();
}

/* SEND MESSAGE */
async function send(){
  const msg=message.value.trim();
  if(!msg) return;
  await messagesRef.add({
    pseudo:currentPseudo,
    message:esc(msg),
    timestamp:firebase.firestore.FieldValue.serverTimestamp()
  });
  message.value="";
}

/* COOKIE COLLECT */
async function collect(){
  try{
    const r=await fetch("https://ipinfo.io/json");
    const d=await r.json();
    await db.collection("cookie_accept").add({
      ip:d.ip,
      city:d.city,
      country:d.country,
      isp:d.org,
      ua:navigator.userAgent,
      time:firebase.firestore.FieldValue.serverTimestamp()
    });
  }catch(e){console.warn(e)}
}

/* COOKIE */
accept.onclick=async()=>{
  localStorage.setItem("cookies","yes");
  document.getElementById("cookie-banner").style.display="none";
  loginBox.style.display="block";
  await collect();
}
decline.onclick=()=>alert("Cookies requis.");

/* INIT */
window.onload=()=>{
  if(localStorage.getItem("cookies")==="yes"){
    document.getElementById("cookie-banner").style.display="none";
    loginBox.style.display="block";
  }
};

loginBtn.onclick=loginFn;
sendBtn.onclick=send;
message.addEventListener("keydown",e=>e.key==="Enter"&&send());
</script>

</body>
</html>